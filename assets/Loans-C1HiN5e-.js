import{S as e,T as t,_ as n,a as r,c as i,f as a,h as o,i as s,l as c,m as l,o as u,s as d,v as f}from"./index-BIgqh-1w.js";import{t as p}from"./Alert-C9_zaemh.js";/* empty css              */var m=t(e()),h=t(r()),g=()=>{let{currentUser:e}=s(),[t,r]=(0,m.useState)(``),[g,_]=(0,m.useState)(``),[v,y]=(0,m.useState)(``),[b,x]=(0,m.useState)([]),[S,C]=(0,m.useState)(!1),[w,T]=(0,m.useState)(``),[E,D]=(0,m.useState)(``),[O,k]=(0,m.useState)(!0);(0,m.useEffect)(()=>{if(!e)return;let t=l(i(u,`loans`),f(`userId`,`==`,e.uid)),n=a(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),t.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),x(t),k(!1)},t=>{console.error(`Error fetching cashout requests:`,t);let n=a(i(u,`loans`),t=>{let n=[];t.forEach(t=>{let r=t.data();r.userId===e.uid&&n.push({id:t.id,...r})}),n.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),x(n),k(!1)});return()=>n()});return()=>n()},[e]);let A=async n=>{if(n.preventDefault(),!t||!g||!v){T(`Please fill in all fields`);return}if(parseFloat(t)<=0){T(`Amount must be greater than 0`);return}C(!0),T(``),D(``);try{await d(i(u,`loans`),{userId:e.uid,amount:parseFloat(t),name:g,reason:v,status:`pending`,userDecision:`pending`,timestamp:o()}),r(``),_(``),y(``),D(`Cashout request submitted successfully!`)}catch(e){console.error(`Error submitting cashout request:`,e),T(`Failed to submit cashout request. Please try again.`)}finally{C(!1)}},j=e=>{switch(e){case`accepted`:return`status-accepted`;case`denied`:return`status-denied`;case`pending`:default:return`status-pending`}},M=e=>{if(!e)return`N/A`;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} · ${i} ${a}`};return(0,h.jsx)(`div`,{className:`whatsapp-container`,children:(0,h.jsxs)(`div`,{className:`main-content`,children:[(0,h.jsx)(`h1`,{className:`page-title`,children:`Loan Request`}),w&&(0,h.jsx)(p,{type:`error`,message:w}),E&&(0,h.jsx)(p,{type:`success`,message:E}),(0,h.jsxs)(`div`,{className:`card animate-slideUp`,children:[(0,h.jsx)(`h2`,{className:`card-title`,children:`New Request`}),(0,h.jsxs)(`form`,{onSubmit:A,className:`form-group`,children:[(0,h.jsxs)(`div`,{children:[(0,h.jsx)(`label`,{className:`form-label`,children:`Amount`}),(0,h.jsx)(`input`,{type:`number`,value:t,onChange:e=>r(e.target.value),className:`form-input`,placeholder:`Enter amount`,min:`0`,step:`0.01`})]}),(0,h.jsxs)(`div`,{children:[(0,h.jsx)(`label`,{className:`form-label`,children:`Your Name`}),(0,h.jsx)(`input`,{type:`text`,value:g,onChange:e=>_(e.target.value),className:`form-input`,placeholder:`Enter your name`})]}),(0,h.jsxs)(`div`,{children:[(0,h.jsx)(`label`,{className:`form-label`,children:`Reason`}),(0,h.jsx)(`textarea`,{value:v,onChange:e=>y(e.target.value),className:`form-textarea`,placeholder:`Enter reason for cashout`,rows:`3`})]}),(0,h.jsx)(`button`,{type:`submit`,disabled:S,className:`form-button`,children:S?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(`div`,{className:`spinner`}),`Sending...`]}):`Send Request`})]})]}),(0,h.jsxs)(`div`,{className:`card`,children:[(0,h.jsx)(`h2`,{className:`card-title`,children:`Your Requests`}),O?(0,h.jsx)(`div`,{className:`loading-indicator`,children:(0,h.jsxs)(`div`,{className:`loading-dots`,children:[(0,h.jsx)(`div`,{className:`loading-dot`}),(0,h.jsx)(`div`,{className:`loading-dot`}),(0,h.jsx)(`div`,{className:`loading-dot`})]})}):b.length===0?(0,h.jsx)(`p`,{className:`empty-state`,children:`No cashout requests found`}):(0,h.jsx)(`div`,{className:`request-list`,children:b.map(e=>(0,h.jsxs)(`div`,{className:`request-item animate-slideUp`,children:[(0,h.jsxs)(`div`,{className:`request-header`,children:[(0,h.jsxs)(`div`,{className:`request-info`,children:[(0,h.jsxs)(`h3`,{children:[`Amount: $`,e.amount]}),(0,h.jsxs)(`p`,{children:[`Name: `,e.name]}),(0,h.jsxs)(`p`,{children:[`Reason: `,e.reason]}),(0,h.jsx)(`img`,{src:e.receiptUrl,alt:``})]}),(0,h.jsx)(`div`,{className:`request-status ${j(e.status)}`,children:e.status})]}),(0,h.jsxs)(`div`,{className:`request-footer`,children:[`Requested on `,M(e.timestamp)]}),e.status!==`pending`&&(0,h.jsxs)(`div`,{className:`mt-3`,children:[(0,h.jsx)(`p`,{className:`text-sm text-gray-500 mb-2`,children:`What do you think about this decision?`}),(!e.userDecision||e.userDecision===`pending`)&&(0,h.jsxs)(`div`,{className:`flex gap-3`,children:[(0,h.jsx)(`button`,{onClick:async()=>{await n(c(u,`loans`,e.id),{userDecision:`accepted`,userDecisionAt:o()})},className:`px-3 py-1 rounded-lg bg-green-600 text-white hover:bg-green-700 text-sm`,children:`I Accept`}),(0,h.jsx)(`button`,{onClick:async()=>{await n(c(u,`loans`,e.id),{userDecision:`denied`,userDecisionAt:o()})},className:`px-3 py-1 rounded-lg bg-red-600 text-white hover:bg-red-700 text-sm`,children:`I Reject`})]}),e.userDecision===`accepted`&&(0,h.jsx)(`p`,{className:`text-green-600 text-sm font-semibold`,children:`✔ You accepted this decision.`}),e.userDecision===`denied`&&(0,h.jsx)(`p`,{className:`text-red-600 text-sm font-semibold`,children:`✖ You disagreed with this decision.`})]})]},e.id))})]})]})})};export{g as default};